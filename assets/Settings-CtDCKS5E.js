import{_ as S,i as $,r as v,o as N,j as A,b as l,c as d,d as o,e as w,w as y,T as B,k as I,n as p,l as m,v as h,g as i,q as P,t as x,p as M,m as D}from"./index-D3ouuQFZ.js";import{u as z,m as f,e as L}from"./index-DLCzZBGj.js";import{a as k}from"./axios-BimPEqV4.js";const C={name:"Settings",setup(){const e=$({user:{Vorname:"",Nachname:"",Brokername:"",Email:"",Passwort:""},updateUser:{Vorname:"",Nachname:"",Brokername:"",Email:"",Passwort:""}}),r=v(!1),g=v(!1),s={updateUser:{Vorname:{minLength:f(3)},Nachname:{minLength:f(3)},Brokername:{minLength:f(7)},Email:{email:L},Passwort:{minLength:f(6)}}},b=v(""),c=a=>{b.value=a,setTimeout(()=>b.value="",5e3)},t=z(s,e),V=async()=>{try{const a=localStorage.getItem("userid"),n=await k.get(`https://os-beyond.at/htl/smart_sensor_netz/user/${a}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("User data fetched:",n.data),e.user=n.data||{}}catch(a){console.error("Error fetching user data:",a)}},E=async()=>{if(g.value&&(t.value.$validate(),!t.value.$error))try{const a=localStorage.getItem("userid"),n={Vorname:e.updateUser.Vorname||e.user.Vorname,Nachname:e.updateUser.Nachname||e.user.Nachname,Brokername:e.updateUser.Brokername||e.user.Brokername,Email:e.updateUser.Email||e.user.Email};e.updateUser.Passwort&&(n.Passwort=e.updateUser.Passwort);const U=await k.put(`https://os-beyond.at/htl/smart_sensor_netz/user/${a}`,n,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}});console.log("User updated successfully:",U.data),U.data&&(e.user={...n},r.value=!0,setTimeout(()=>r.value=!1,3e3),g.value=!1)}catch(a){console.error("Error updating user:",a),a.response?(console.log("Error Response:",a.response.data),a.response.status===400||a.response.status===409?a.response.data.message==="E-Mail bereits registriert"?c("❌ Diese E-Mail ist bereits vergeben!"):c(`⚠️ Fehler: ${a.response.data.message}`):c(`⚠️ Fehler: ${a.response.status} - Bitte versuche es später erneut.`)):c("⚠️ Fehler beim Aktualisieren der Einstellungen. Bitte überprüfe deine Internetverbindung.")}},_=async()=>{const a=localStorage.getItem("userid");if(confirm("Bist du sicher, dass du deinen Account löschen möchtest? Diese Aktion kann nicht rückgängig gemacht werden!"))try{await k.delete(`https://os-beyond.at/htl/smart_sensor_netz/user/${a}`,{headers:{Authorization:"Bearer "+localStorage.getItem("token")}}),console.log("Account erfolgreich gelöscht"),localStorage.removeItem("userid"),localStorage.removeItem("token"),window.location.href="/vueDiplomarbeit/"}catch(n){console.error("Fehler beim Löschen des Accounts:",n)}};return N(()=>{V()}),{...A(e),v$:t,updateSuccess:r,updateAllowed:g,updateSettings:E,errorMessage:b,deleteAccount:_}}},u=e=>(M("data-v-aa76519e"),e=e(),D(),e),G={class:"flex justify-center items-center mt-10"},T={class:"w-1/3"},F=u(()=>o("h2",{class:"text-2xl font-bold mb-4"},"Settings",-1)),Z={key:0,class:"text-green-600 font-bold mb-4"},j={key:0,class:"text-red-600 font-bold mb-4"},R=u(()=>o("label",{for:"Vorname",class:"block mb-2"},"Vorname",-1)),q=["placeholder"],H={key:0},J=u(()=>o("label",{for:"Nachname",class:"block mb-2"},"Nachname",-1)),K=["placeholder"],O={key:0},Q=u(()=>o("label",{for:"Brokername",class:"block mb-2"},"Brokername",-1)),W=["placeholder"],X={key:0},Y=u(()=>o("label",{for:"Email",class:"block mb-2"},"Email",-1)),ee=["placeholder"],re={key:0},se=u(()=>o("label",{for:"Passwort",class:"block mb-2"},"Passwort",-1)),te={key:0},oe={class:"mb-4"},ae=u(()=>o("label",{for:"confirmUpdate"},"Ich bestätige, dass ich meine Daten aktualisieren möchte",-1)),ne=["disabled"];function le(e,r,g,s,b,c){return l(),d("div",G,[o("div",T,[F,w(B,{name:"fade"},{default:y(()=>[s.updateSuccess?(l(),d("p",Z,"Settings erfolgreich geupdated!")):i("",!0)]),_:1}),w(B,{name:"fade"},{default:y(()=>[s.errorMessage?(l(),d("p",j,x(s.errorMessage),1)):i("",!0)]),_:1}),o("form",{onSubmit:r[12]||(r[12]=I((...t)=>s.updateSettings&&s.updateSettings(...t),["prevent"]))},[o("div",{class:p(["mb-4",{"form-group-error":s.v$.updateUser.Vorname.$error}])},[R,m(o("input",{type:"text",id:"Vorname",class:"w-full px-4 py-2 border border-green-500 rounded",placeholder:e.user.Vorname||"Gib deinen Vornamen ein","onUpdate:modelValue":r[0]||(r[0]=t=>e.updateUser.Vorname=t),onBlur:r[1]||(r[1]=t=>s.v$.updateUser.Vorname.$touch())},null,40,q),[[h,e.updateUser.Vorname]]),s.v$.updateUser.Vorname.$error?(l(),d("span",H,"Vorname muss mindestens 3 Zeichen lang sein")):i("",!0)],2),o("div",{class:p(["mb-4",{"form-group-error":s.v$.updateUser.Nachname.$error}])},[J,m(o("input",{type:"text",id:"Nachname",class:"w-full px-4 py-2 border border-green-500 rounded",placeholder:e.user.Nachname||"Gib deinen Nachnamen ein","onUpdate:modelValue":r[2]||(r[2]=t=>e.updateUser.Nachname=t),onBlur:r[3]||(r[3]=t=>s.v$.updateUser.Nachname.$touch())},null,40,K),[[h,e.updateUser.Nachname]]),s.v$.updateUser.Nachname.$error?(l(),d("span",O,"Nachname muss mindestens 3 Zeichen lang sein")):i("",!0)],2),o("div",{class:p(["mb-4",{"form-group-error":s.v$.updateUser.Brokername.$error}])},[Q,m(o("input",{type:"text",id:"Brokername",class:"w-full px-4 py-2 border border-green-500 rounded",placeholder:e.user.Brokername||"Gib deinen Brokername ein","onUpdate:modelValue":r[4]||(r[4]=t=>e.updateUser.Brokername=t),onBlur:r[5]||(r[5]=t=>s.v$.updateUser.Brokername.$touch())},null,40,W),[[h,e.updateUser.Brokername]]),s.v$.updateUser.Brokername.$error?(l(),d("span",X,"Brokername muss mindestens 7 Zeichen lang sein")):i("",!0)],2),o("div",{class:p(["mb-4",{"form-group-error":s.v$.updateUser.Email.$error}])},[Y,m(o("input",{type:"email",id:"Email",class:"w-full px-4 py-2 border border-green-500 rounded",placeholder:e.user.Email||"Gib deine Email ein","onUpdate:modelValue":r[6]||(r[6]=t=>e.updateUser.Email=t),onBlur:r[7]||(r[7]=t=>s.v$.updateUser.Email.$touch())},null,40,ee),[[h,e.updateUser.Email]]),s.v$.updateUser.Email.$error?(l(),d("span",re,"Gültige Email-Adresse eingeben")):i("",!0)],2),o("div",{class:p(["mb-4",{"form-group-error":s.v$.updateUser.Passwort.$error}])},[se,m(o("input",{type:"password",id:"Passwort",class:"w-full px-4 py-2 border border-green-500 rounded","onUpdate:modelValue":r[8]||(r[8]=t=>e.updateUser.Passwort=t),onBlur:r[9]||(r[9]=t=>s.v$.updateUser.Passwort.$touch())},null,544),[[h,e.updateUser.Passwort]]),s.v$.updateUser.Passwort.$error?(l(),d("span",te,"Passwort muss mindestens 6 Zeichen lang sein")):i("",!0)],2),o("div",oe,[m(o("input",{type:"checkbox",id:"confirmUpdate","onUpdate:modelValue":r[10]||(r[10]=t=>s.updateAllowed=t),class:"mr-2"},null,512),[[P,s.updateAllowed]]),ae]),o("button",{type:"submit",class:"w-full bg-green-700 text-white py-2 px-4 rounded hover:bg-green-800 disabled:bg-gray-400",disabled:!s.updateAllowed}," Speichern 💾 ",8,ne),o("button",{type:"button",class:"w-full bg-red-600 text-white py-2 px-4 rounded mt-4 hover:bg-red-700",onClick:r[11]||(r[11]=(...t)=>s.deleteAccount&&s.deleteAccount(...t))}," Account löschen 🗑️ ")],32)])])}const me=S(C,[["render",le],["__scopeId","data-v-aa76519e"]]);export{me as default};
